# Yu Jian Lab - 系统架构概览

## 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                     用户层 (User Layer)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  Telegram   │  │  Web UI     │  │  Twitter/X          │  │
│  │  (主要交互)  │  │  (仪表盘)   │  │  (社交展示)         │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘  │
└─────────┼────────────────┼────────────────────┼─────────────┘
          │                │                    │
          ▼                ▼                    ▼
┌─────────────────────────────────────────────────────────────┐
│                    API 网关层 (Gateway)                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  OpenClaw Gateway (WebSocket + REST)                │   │
│  │  - 消息路由                                          │   │
│  │  - 会话管理                                          │   │
│  │  - 模型调度                                          │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────┐
│                   核心服务层 (Core Services)                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  AI Agent   │  │  Lab API    │  │  Automation         │  │
│  │  (遇见本体)  │  │  (状态/历史) │  │  (定时任务)         │  │
│  │             │  │             │  │                     │  │
│  │  - 推理引擎  │  │  - 状态同步  │  │  - 邮件检查         │  │
│  │  - 工具调用  │  │  - 历史记录  │  │  - 模型监控         │  │
│  │  - 记忆管理  │  │  - 访问统计  │  │  - 交易机器人       │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
          │
          ▼
┌─────────────────────────────────────────────────────────────┐
│                   基础设施层 (Infrastructure)                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  Server     │  │  Database   │  │  External APIs      │  │
│  │  (Silicon   │  │  (SQLite/   │  │                     │  │
│  │   Valley)   │  │   Postgres) │  │  - OKX              │  │
│  │             │  │             │  │  - Twitter          │  │
│  │  Docker     │  │  - 状态数据  │  │  - Various LLMs     │  │
│  │  Caddy      │  │  - 历史记录  │  │                     │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 数据流

### 1. 状态同步流
```
本地状态脚本 → API (api.yujian.team/status) → SQLite → WebSocket → 前端仪表盘
     ↑                                                              ↓
     └──────────────── 用户查看 lab.yujian.team ───────────────────┘
```

### 2. 指令处理流
```
用户消息 (Telegram) → OpenClaw Gateway → AI Agent → 工具执行 → 结果返回
                                          ↓
                                    历史记录存储
```

### 3. 自动化任务流
```
crontab → 脚本执行 → API调用/数据处理 → 状态更新 → 通知用户(如需要)
```

## 技术栈

### 前端
- **框架**: React + TypeScript
- **构建**: Vite
- **样式**: Tailwind CSS
- **部署**: Docker + Nginx

### 后端
- **运行时**: Bun
- **框架**: Elysia (TypeScript)
- **数据库**: SQLite (轻量级，适合当前规模)
- **实时**: WebSocket (Elysia 原生支持)

### AI/自动化
- **核心**: OpenClaw Gateway
- **模型**: Kimi K2.5 (OpenCode) / Gemini / NVIDIA
- **调度**: 自动模型切换 + 配额监控

### 基础设施
- **服务器**: Ubuntu 24.04 (Silicon Valley)
- **容器**: Docker Compose
- **反向代理**: Caddy
- **域名**: yujian.team / yujian.cool

## 自动化系统

### 定时任务 (crontab)
| 任务 | 频率 | 功能 |
|------|------|------|
| 智能状态同步 | 每分钟 | 检测工作状态并更新 API |
| 模型配额监控 | 每5分钟 | 检测 429 错误并告警 |
| 邮件检查 | 每5分钟 | 检查新邮件并通知 |

### 模型优先级队列
1. Kimi K2.5 Free (OpenCode) - 主要
2. Kimi K2.5 (NVIDIA) - 备用1
3. Gemini 2.5 Flash - 备用2
4. Gemini 2.5 Pro - 备用3
5. Kimi K2 (Moonshot) - 备用4

## 安全考虑

- API 密钥存储在环境变量
- 数据库使用隐私友好的 IP 哈希
- 所有外部 API 调用都有错误处理
- 模型切换有冷却期防止频繁切换

## 扩展计划

### 短期 (1-2周)
- WebSocket 实时推送
- 历史数据可视化图表
- 交易机器人风控模块

### 中期 (1-3月)
- 多语言支持完善
- 移动端适配优化
- DeFi 收益监控集成

### 长期 (3-6月)
- 自主盈利模块上线
- 机器学习预测模型
- 社区功能 (评论/互动)

---
*文档版本: 2026-02-02*  
*作者: 遇见 (Yu Jian)*
